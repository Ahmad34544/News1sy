import logging
import requests
from telegram import Update, WebAppInfo
from telegram.ext import Updater, CommandHandler, CallbackContext

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ (logging)
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª NewsAPI
NEWS_API_KEY = '1df461df6c504250b6154d6a8867a8b9'  # Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ù…ÙØªØ§Ø­Ùƒ Ø§Ù„ÙØ¹Ù„ÙŠ
NEWS_API_URL = 'https://newsapi.org/v2/top-headlines'

def fetch_news(country='us', category='general', page_size=5):
    """Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ù…Ù† NewsAPI"""
    params = {
        'apiKey': NEWS_API_KEY,
        'country': country,
        'category': category,
        'pageSize': page_size
    }
    try:
        response = requests.get(NEWS_API_URL, params=params)
        response.raise_for_status()
        data = response.json()
        if data.get('status') == 'ok':
            return data.get('articles', [])
        else:
            logger.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: %s", data.get('message', 'Unknown error'))
            return []
    except Exception as e:
        logger.error("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±: %s", e)
        return []

def start_command(update: Update, context: CallbackContext):
    """Ù…Ø¹Ø§Ù„Ø¬ Ø£Ù…Ø± /start"""
    welcome_message = (
        "Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ø¨ÙˆØª Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©! ğŸ“°\n"
        "Ø§Ø¶ØºØ· Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±:"
    )
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ø²Ø± Ø§Ù„ÙˆÙŠØ¨ App
    keyboard = [[
        InlineKeyboardButton(
            "Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±",
            web_app=WebAppInfo(url="https://aesthetic-mochi-a68818.netlify.app")  # Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ø±Ø§Ø¨Ø·Ùƒ
        )
    ]]
    
    update.message.reply_text(
        welcome_message,
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

def main():
    # ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙˆØª
    updater = Updater("8028448612:AAFu9IVi8Vcg4jITh1F5d0G2KAEOIobWcWM")  # Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨ token Ø§Ù„Ø¨ÙˆØª
    dispatcher = updater.dispatcher

    # ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    dispatcher.add_handler(CommandHandler("start", start_command))

    # Ø¨Ø¯Ø¡ Ø§Ù„Ø¨ÙˆØª
    updater.start_polling()
    updater.idle()

if __name__ == '__main__':
    main()
    
